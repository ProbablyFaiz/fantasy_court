# Static Blog Architecture with Next.js + Python

*Drafted by Claude as a summary of an exchange about how to design this project.*

## Overview
Static site generator pattern: Python backend generates JSON data, Next.js pre-renders HTML at build time, deploy to Cloudflare Pages.

## Architecture

### Data Layer (Python)
- **Backend:** Python + Postgres + Celery (runs locally on schedule)
- **Output:** JSON files written to `frontend/public/data/`
  - `index.json` - Lightweight metadata for all posts (ID, slug, title, date, excerpt, tags)
  - `posts/{slug}.json` - Full content for individual posts

### Frontend Layer (Next.js Pages Router)
- **Framework:** React + Next.js (Pages Router)
- **Build:** Static Site Generation (SSG)
- **Routes:**
  - `/` - Homepage (list of posts from `index.json`)
  - `/opinions/[slug]` - Individual post pages
- **SEO:** Pre-rendered HTML files for all pages (Google can index)
- **UX:** Still functions as SPA after initial load

## Sketch of Workflow

1. **Python scheduled job** (runs on your machine):
   ```bash
   python generate_data.py  # Queries DB, outputs JSON to frontend/public/data/
   ```

2. **Build static site**:
   ```bash
   cd frontend
   pnpm build  # Next.js generates HTML files in 'out/' folder
   ```

3. **Deploy**:
   ```bash
   wrangler pages publish out  # Upload to Cloudflare Pages
   ```

## Key Files

```
project/
├── backend/
│   └── generate_data.py       # Python script (scheduled job)
├── frontend/
│   ├── pages/
│   │   ├── index.jsx          # Homepage (uses getStaticProps)
│   │   └── posts/
│   │       └── [slug].jsx     # Post page (uses getStaticPaths + getStaticProps)
│   ├── public/
│   │   └── data/              # Generated by Python
│   │       ├── index.json
│   │       └── posts/*.json
│   └── next.config.js         # { output: 'export' }
```

## Scaling Considerations

### If index grows large:
- Paginate: `index-page-1.json`, `index-page-2.json`
- Or shard by date: `index-2025.json`, `index-2024.json`

### Cache strategy:
- `index.json`: Short cache (5 min) - changes frequently
- `posts/*.json`: Long cache (1 year, immutable) - rarely change
- If post updates: Use versioned filenames (`post-slug-v2.json`)

## Benefits
- No backend required in production
- Fast load times (static HTML)
- SEO-friendly (pre-rendered HTML)
- Cheap hosting (Cloudflare Pages)
- Still feels like SPA after initial load
- Python backend only runs locally on schedule
